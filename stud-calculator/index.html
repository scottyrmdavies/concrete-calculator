<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stud Work Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --calidwell-primary-accent: #30C7B5;
            --calidwell-secondary-accent: #00AC97;
            --calidwell-dark-text: #14261C;
            --calidwell-general-text: #4F5655;
            --calidwell-light-bg-1: #F3F6F3;
            --calidwell-light-bg-2: #F6F7F8;
            --calidwell-white: #FFFFFF;
            --calidwell-border-grey: #dddddd;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--calidwell-light-bg-1); }
        .quantity-input { padding: 0.75rem; border-width: 2px; border-color: var(--calidwell-border-grey); border-radius: 0.375rem; width: 100%; box-sizing: border-box; }
        .quantity-input:focus { border-color: var(--calidwell-primary-accent); box-shadow: 0 0 0 3px rgba(48,199,181,0.5); outline: none; }
        input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
    </style>
    <meta name="description" content="Estimate studs, noggins, plates, and total linear meters for stud walls.">
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-5xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-[var(--calidwell-dark-text)] mb-6 text-center">Stud Work Calculator</h1>

        <!-- Walls -->
        <div class="mb-6 p-4 bg-[var(--calidwell-light-bg-2)] rounded-lg border border-[var(--calidwell-border-grey)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-semibold text-[var(--calidwell-dark-text)]">Walls</h2>
                <button id="addWallBtn" class="bg-[var(--calidwell-primary-accent)] hover:bg-[var(--calidwell-secondary-accent)] text-white font-semibold py-2 px-4 rounded-md shadow transition">Add Wall</button>
            </div>
            <div class="overflow-x-auto rounded-md border border-[var(--calidwell-border-grey)] bg-white">
                <table class="min-w-full text-sm">
                    <thead class="bg-[var(--calidwell-light-bg-1)] text-[var(--calidwell-general-text)]">
                        <tr>
                            <th class="text-left px-3 py-2">Name</th>
                            <th class="text-left px-3 py-2">Length (m)</th>
                            <th class="text-left px-3 py-2">Height (m)</th>
                            <th class="text-left px-3 py-2">Centers</th>
                            <th class="text-left px-3 py-2">Noggins Rows</th>
                            <th class="text-left px-3 py-2">Qty</th>
                            <th class="text-left px-3 py-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="wallsBody" class="divide-y divide-[var(--calidwell-border-grey)] text-[var(--calidwell-dark-text)]"></tbody>
                </table>
            </div>
        </div>

        <!-- Openings (Doors/Windows) -->
        <div class="mb-6 p-4 bg-[var(--calidwell-light-bg-2)] rounded-lg border border-[var(--calidwell-border-grey)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-semibold text-[var(--calidwell-dark-text)]">Openings (optional)</h2>
                <button id="addOpeningBtn" class="bg-[var(--calidwell-primary-accent)] hover:bg-[var(--calidwell-secondary-accent)] text-white font-semibold py-2 px-4 rounded-md shadow transition">Add Opening</button>
            </div>
            <div class="overflow-x-auto rounded-md border border-[var(--calidwell-border-grey)] bg-white">
                <table class="min-w-full text-sm">
                    <thead class="bg-[var(--calidwell-light-bg-1)] text-[var(--calidwell-general-text)]">
                        <tr>
                            <th class="text-left px-3 py-2">Name</th>
                            <th class="text-left px-3 py-2">Width (m)</th>
                            <th class="text-left px-3 py-2">Height (m)</th>
                            <th class="text-left px-3 py-2">Qty</th>
                            <th class="text-left px-3 py-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="openingsBody" class="divide-y divide-[var(--calidwell-border-grey)] text-[var(--calidwell-dark-text)]"></tbody>
                </table>
            </div>
        </div>

        <!-- Units + Parameters -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="md:col-span-3">
                <label class="block text-sm font-medium text-[var(--calidwell-general-text)] mb-1">Units</label>
                <select id="unitSystem" class="quantity-input text-[var(--calidwell-dark-text)] max-w-xs">
                    <option value="metric" selected>Metric (m, mm, m²)</option>
                    <option value="imperial">Imperial (ft, in, ft²)</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-[var(--calidwell-general-text)] mb-1">Corner Allowance (m per internal corner)</label>
                <input id="cornerAllowanceM" type="number" step="0.1" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="e.g. 0.6">
            </div>
            <div>
                <label class="block text-sm font-medium text-[var(--calidwell-general-text)] mb-1">Internal Corners</label>
                <input id="numCorners" type="number" step="1" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="e.g. 2">
            </div>
            <div>
                <label class="block text-sm font-medium text-[var(--calidwell-general-text)] mb-1">Estimate Mode</label>
                <select id="estimateMode" class="quantity-input text-[var(--calidwell-dark-text)]">
                    <option value="calc">Calculated (from centers and noggins)</option>
                    <option value="ratio">Simple ratio (4.5 lm per m²)</option>
                </select>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <button id="calculateBtn" class="w-full sm:w-auto bg-[var(--calidwell-primary-accent)] hover:bg-[var(--calidwell-secondary-accent)] text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-200 ease-in-out transform hover:scale-105">Calculate</button>
            <button id="resetBtn" class="w-full sm:w-auto bg-white text-[var(--calidwell-dark-text)] border border-[var(--calidwell-border-grey)] font-bold py-3 px-6 rounded-md shadow-sm">Reset</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-[var(--calidwell-light-bg-2)] p-4 rounded-md border border-[var(--calidwell-border-grey)]">
                <h2 class="text-lg font-semibold text-[var(--calidwell-dark-text)] mb-2">Results</h2>
                <ul class="text-sm text-[var(--calidwell-dark-text)] space-y-1">
                    <li><span class="text-[var(--calidwell-general-text)]">Total Wall Area:</span> <span id="totalArea" class="font-semibold">0.00 m²</span></li>
                    <li><span class="text-[var(--calidwell-general-text)]">Studs (count):</span> <span id="studCount" class="font-semibold">0</span></li>
                    <li><span class="text-[var(--calidwell-general-text)]">Noggin Length:</span> <span id="nogginLm" class="font-semibold">0.00 m</span></li>
                    <li><span class="text-[var(--calidwell-general-text)]">Plates Length (head + floor):</span> <span id="platesLm" class="font-semibold">0.00 m</span></li>
                    <li><span class="text-[var(--calidwell-general-text)]">Corner Allowance:</span> <span id="cornerLm" class="font-semibold">0.00 m</span></li>
                    <li><span class="text-[var(--calidwell-general-text)]">Total Linear Meters (timber):</span> <span id="totalLm" class="font-semibold">0.00 m</span></li>
                </ul>
            </div>

            <div class="bg-[var(--calidwell-light-bg-2)] p-4 rounded-md border border-[var(--calidwell-border-grey)]">
                <h2 class="text-lg font-semibold text-[var(--calidwell-dark-text)] mb-2">Notes</h2>
                <ul class="list-disc pl-5 text-sm text-[var(--calidwell-general-text)] space-y-1">
                    <li>Centers supported: 400 mm or 600 mm.</li>
                    <li>Noggins rows are horizontal lines between studs; default 1 for up to ~2.4 m height.</li>
                    <li>Plates include one head and one floor plate per wall run.</li>
                    <li>Corner allowance adds extra timber to carry internal boards.</li>
                    <li>Ratio mode uses approx 4.5 lm per m² of wall as a quick check.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function toNumber(value) { const n = parseFloat(value); return isNaN(n) ? 0 : n; }

        document.getElementById('calculateBtn').addEventListener('click', calculate);
        document.getElementById('resetBtn').addEventListener('click', resetForm);
        document.getElementById('addWallBtn').addEventListener('click', () => addWallRow());
        document.getElementById('addOpeningBtn').addEventListener('click', () => addOpeningRow());
        document.getElementById('unitSystem').addEventListener('change', onUnitsChange);

        function addWallRow(initial = {}) {
            const tbody = document.getElementById('wallsBody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="px-3 py-2"><input type="text" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="e.g. Wall A" value="${initial.name || ''}"></td>
                <td class="px-3 py-2 min-w-[110px]"><input type="number" step="0.01" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="0.00" value="${initial.length ?? ''}"></td>
                <td class="px-3 py-2 min-w-[110px]"><input type="number" step="0.01" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="0.00" value="${initial.height ?? ''}"></td>
                <td class="px-3 py-2">
                    <select class="quantity-input text-[var(--calidwell-dark-text)]">
                        <option value="400" ${initial.centers === 600 ? '' : 'selected'}>400 mm</option>
                        <option value="600" ${initial.centers === 600 ? 'selected' : ''}>600 mm</option>
                    </select>
                </td>
                <td class="px-3 py-2 min-w-[110px]"><input type="number" step="1" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="1" value="${initial.noggins ?? 1}"></td>
                <td class="px-3 py-2 min-w-[80px]"><input type="number" step="1" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="1" value="${initial.qty ?? 1}"></td>
                <td class="px-3 py-2"><button class="remove-wall bg-[var(--calidwell-primary-accent)] hover:bg-[var(--calidwell-secondary-accent)] text-white px-3 py-2 rounded-md">Remove</button></td>
            `;
            tbody.appendChild(tr);

            const inputs = tr.querySelectorAll('input');
            inputs.forEach(input => input.addEventListener('input', () => calculate()));
            tr.querySelector('select').addEventListener('change', () => calculate());
            tr.querySelector('.remove-wall').addEventListener('click', () => { tr.remove(); calculate(); });
        }

        function resetForm() {
            document.getElementById('wallsBody').innerHTML = '';
            document.getElementById('openingsBody').innerHTML = '';
            document.getElementById('cornerAllowanceM').value = '';
            document.getElementById('numCorners').value = '';
            document.getElementById('estimateMode').value = 'calc';
        }

        function calculate() {
            const rows = document.querySelectorAll('#wallsBody tr');
            let totalArea = 0;
            let studsCount = 0;
            let nogginLm = 0;
            let platesLm = 0;
            let totalWallLength = 0;

            const isImperial = document.getElementById('unitSystem').value === 'imperial';
            rows.forEach(tr => {
                let length = toNumber(tr.querySelectorAll('input')[1].value);
                let height = toNumber(tr.querySelectorAll('input')[2].value);
                if (isImperial) { length = length * 0.3048; height = height * 0.3048; }
                const centersMm = parseInt(tr.querySelector('select').value, 10);
                const nogginsRows = Math.max(0, Math.floor(toNumber(tr.querySelectorAll('input')[3].value)));
                const qty = Math.max(1, Math.floor(toNumber(tr.querySelectorAll('input')[4].value)) || 1);

                if (length <= 0 || height <= 0 || qty <= 0) return;

                const area = length * height * qty;
                totalArea += area;
                totalWallLength += length * qty;

                // Studs per single wall run: studs at each end + at regular centers across length
                const centersM = centersMm / 1000;
                const studsPerRun = Math.max(2, Math.floor(length / centersM) + 1); // include end stud
                studsCount += studsPerRun * qty;

                // Noggins length: number of rows * total stud bays width (approx equal to length)
                // Approximate as length per run times rows times qty
                nogginLm += length * nogginsRows * qty;

                // Plates: head + floor per run, each equals the wall length
                platesLm += length * 2 * qty;
            });

            // Openings adjustments
            const openings = document.querySelectorAll('#openingsBody tr');
            let openingsArea = 0;
            let openingsWidthTotal = 0;
            let openingCount = 0;
            openings.forEach(tr => {
                let width = toNumber(tr.querySelectorAll('input')[0].value);
                let height = toNumber(tr.querySelectorAll('input')[1].value);
                if (isImperial) { width = width * 0.3048; height = height * 0.3048; }
                const qty = Math.max(0, Math.floor(toNumber(tr.querySelectorAll('input')[2].value)) || 0);
                if (width > 0 && height > 0 && qty > 0) {
                    openingsArea += width * height * qty;
                    openingsWidthTotal += width * qty;
                    openingCount += qty;
                }
            });

            // Subtract openings area from wall area (not below zero)
            totalArea = Math.max(0, totalArea - openingsArea);

            // Add trimmer studs: 2 per opening
            studsCount += openingCount * 2;

            // Reduce noggin length based on openings horizontally crossing
            // Estimate rows per meter from current nogginLm and wall length
            const rowsPerMeter = totalWallLength > 0 ? (nogginLm / totalWallLength) : 0;
            nogginLm = Math.max(0, nogginLm - openingsWidthTotal * rowsPerMeter);

            // Corner allowance
            let cornerAllowanceM = toNumber(document.getElementById('cornerAllowanceM').value);
            const numCorners = Math.max(0, Math.floor(toNumber(document.getElementById('numCorners').value)) || 0);
            if (isImperial) { cornerAllowanceM = cornerAllowanceM * 0.3048; }
            const cornerLm = cornerAllowanceM * numCorners;

            let totalLm = 0;
            const mode = document.getElementById('estimateMode').value;
            if (mode === 'ratio') {
                // Quick estimate: 4.5 lm per m² + corner allowance
                totalLm = 4.5 * totalArea + cornerLm;
            } else {
                // Calculated: studs vertical length + noggins + plates + corners
                const avgWallHeight = computeAverageWallHeight();
                const studsLm = studsCount * avgWallHeight;
                totalLm = studsLm + nogginLm + platesLm + cornerLm;
            }

            document.getElementById('totalArea').textContent = totalArea.toFixed(2) + ' m²';
            document.getElementById('studCount').textContent = studsCount.toString();
            document.getElementById('nogginLm').textContent = nogginLm.toFixed(2) + ' m';
            document.getElementById('platesLm').textContent = platesLm.toFixed(2) + ' m';
            document.getElementById('cornerLm').textContent = cornerLm.toFixed(2) + ' m';
            document.getElementById('totalLm').textContent = totalLm.toFixed(2) + ' m';
        }

        function computeAverageWallHeight() {
            const rows = document.querySelectorAll('#wallsBody tr');
            let totalHeight = 0; let count = 0;
            rows.forEach(tr => {
                const height = toNumber(tr.querySelectorAll('input')[2].value);
                const qty = Math.max(1, Math.floor(toNumber(tr.querySelectorAll('input')[4].value)) || 1);
                if (height > 0 && qty > 0) { totalHeight += height * qty; count += qty; }
            });
            return count > 0 ? totalHeight / count : 0;
        }

        function addOpeningRow(initial = {}) {
            const tbody = document.getElementById('openingsBody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="px-3 py-2"><input type="text" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="e.g. Door" value="${initial.name || ''}"></td>
                <td class="px-3 py-2 min-w-[110px]"><input type="number" step="0.01" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="0.90" value="${initial.width ?? ''}"></td>
                <td class="px-3 py-2 min-w-[110px]"><input type="number" step="0.01" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="2.00" value="${initial.height ?? ''}"></td>
                <td class="px-3 py-2 min-w-[80px]"><input type="number" step="1" class="quantity-input text-[var(--calidwell-dark-text)]" placeholder="1" value="${initial.qty ?? 1}"></td>
                <td class="px-3 py-2"><button class="remove-opening bg-[var(--calidwell-primary-accent)] hover:bg-[var(--calidwell-secondary-accent)] text-white px-3 py-2 rounded-md">Remove</button></td>
            `;
            tbody.appendChild(tr);

            const inputs = tr.querySelectorAll('input');
            inputs.forEach(input => input.addEventListener('input', () => calculate()));
            tr.querySelector('.remove-opening').addEventListener('click', () => { tr.remove(); calculate(); });
        }

        // Defaults
        addWallRow({ name: 'Wall A', length: 3.6, height: 2.4, centers: 600, noggins: 1, qty: 1 });
        addWallRow({ name: 'Wall B', length: 2.4, height: 2.4, centers: 400, noggins: 1, qty: 1 });
        addOpeningRow({ name: 'Door', width: 0.9, height: 2.0, qty: 1 });
        document.getElementById('cornerAllowanceM').value = 0.6;
        document.getElementById('numCorners').value = 2;
        document.getElementById('estimateMode').value = 'calc';
        calculate();

        function onUnitsChange() {
            const isImperial = document.getElementById('unitSystem').value === 'imperial';
            // Convert walls table
            document.querySelectorAll('#wallsBody tr').forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                let length = toNumber(inputs[1].value);
                let height = toNumber(inputs[2].value);
                if (length || height) {
                    if (isImperial) {
                        if (length) inputs[1].value = (length / 0.3048).toFixed(2);
                        if (height) inputs[2].value = (height / 0.3048).toFixed(2);
                    } else {
                        if (length) inputs[1].value = (length * 0.3048).toFixed(2);
                        if (height) inputs[2].value = (height * 0.3048).toFixed(2);
                    }
                }
            });
            // Convert openings table
            document.querySelectorAll('#openingsBody tr').forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                let width = toNumber(inputs[1].value);
                let height = toNumber(inputs[2].value);
                if (width || height) {
                    if (isImperial) {
                        if (width) inputs[1].value = (width / 0.3048).toFixed(2);
                        if (height) inputs[2].value = (height / 0.3048).toFixed(2);
                    } else {
                        if (width) inputs[1].value = (width * 0.3048).toFixed(2);
                        if (height) inputs[2].value = (height * 0.3048).toFixed(2);
                    }
                }
            });
            // Corner allowance label left as meters but value converted when calculating
            calculate();
        }
    </script>
</body>
</html>

